# Release Notes & Documentation: v2.3.1 (Atomic Sync Patch)
**Tanggal:** 21 Februari 2026  
**Status:** Deployed to Supabase  
**Versi:** v2.3.1

## 1. Overview
Rilis v2.3.1 adalah patch kritikal yang fokus pada **Integritas Data (Data Integrity)** dan **Sinkronisasi Atomik**. Patch ini memperbaiki bug regresi yang menyebabkan ketidakakuratan saldo dan memperkuat hubungan antara modul Hutang (Debts) dengan Mutasi Transaksi.

---

## 2. Perbaikan Utama (Major Fixes)

### A. Solusi Anti Double-Counting Saldo
*   **Masalah:** Pada versi sebelumnya, saldo dompet terpotong/bertambah dua kali (Double-Counting) karena logika pembaruan saldo dijalankan di dua tempat: Fungsi RPC dan Database Trigger.
*   **Perbaikan:** Menghapus seluruh logika `UPDATE wallets SET balance = ...` dari fungsi RPC `create_transaction_v1` dan `update_transaction_v1`.
*   **Hasil:** Aplikasi kini menggunakan arsitektur **Single Source of Truth**. Saldo hanya dikelola oleh satu Trigger tunggal (`on_transaction_change`) yang menjamin akurasi 100% tanpa risiko duplikasi.

### B. Linkage & Sinkronisasi Pembayaran Hutang
*   **Masalah:** Menghapus pembayaran hutang tidak menghapus transaksi uang terkait, menyebabkan saldo dompet tidak sinkron dengan catatan hutang.
*   **Perbaikan:** 
    *   Menambahkan kolom `transaction_id` pada tabel `debt_payments`.
    *   Memperbarui fungsi `pay_debt_v1` untuk menyimpan ID transaksi saat pembayaran dicatat.
    *   Memperbarui fungsi `delete_debt_payment_v1` agar secara otomatis menghapus mutasi transaksi terkait saat record pembayaran dihapus.
*   **Hasil:** Alur pembayaran hutang kini bersifat **Atomik**. Jika pembayaran dihapus, mutasi uang di dompet otomatis kembali semula (reverted).

---

## 3. Maintenance Database (Supabase Sync)
Selama rilis ini, dilakukan pembersihan besar-besaran pada riwayat migrasi untuk menyamakan status lokal dan remote:
*   **Repair Migration History:** Membersihkan 50+ riwayat migrasi lama (2025) yang tersisa di database remote tapi sudah tidak ada di repo lokal.
*   **Standardized Filenames:** Mengubah nama file migrasi intelijen dan normalisasi menggunakan format timestamp 14-digit (`20260220XXXXXX`) agar kompatibel dengan penomoran Supabase CLI.

---

## 4. Cara Verifikasi Database Terkini
Untuk memastikan lingkungan pengembangan Anda tetap sinkron dengan patch ini, jalankan:
```powershell
npx supabase migration list
```
Pastikan status untuk migrasi `20260221090000_fix_double_counting_and_debt_flow` adalah `Applied`.

---

## 5. Dampak ke Pengguna
*   **Akurasi Saldo:** Pengguna tidak akan lagi melihat saldo yang berkurang/bertambah dua kali lipat saat mencatat transaksi.
*   **Histori Transaksi:** Penghapusan pembayaran hutang kini jauh lebih bersih dan tidak meninggalkan "transaksi sampah" di riwayat keuangan.

---
*Dokumen ini adalah bagian dari standar Lemon "Security & Integrity".*
